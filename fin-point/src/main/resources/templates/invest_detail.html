<html layout:decorate="~{layout}"> <!--layout.html 템플릿을 상속-->
<!-- jQuery 및 자바스크립트 코드 -->

<body>
<div layout:fragment="content" class="container my-3" style="margin: 200px;">
    <form th:value="@{/invest/list/detail/{id}(id=${investDetail.id})}">
        <h2 class="border-bottom py-2" th:text="${investDetail.subject}"></h2>
        <div th:text="${investDetail.content}"></div>
        <a th:href="@{|/invest/delete/${investDetail.id}|}" class="btn btn-primary">삭제</a>
        <a th:href="@{|/invest/modify/${investDetail.id}|}" class="btn btn-primary">수정</a>
        <!--  <a href="javascript:void(0);" th:data-uri="@{|/invest/list/detail/${investDetail.id}|}" class="recommend btn btn-sm btn-outline-secondary">좋아요</a>-->
        <!--  <span class="badge rounded-pill bg-success" th:text="${#lists.size('likes')}"> </span>-->

        <div  th:if="${#request.getCookies()!= null}" >
<!--            or th:unless="${#strings.equals(investDetail.getMember().getEmail(),login_email)}">-->
            <!-- 로그인 유저와 작성자가 동일하지 않다면 -->
            <!-- 좋아요 -->

                <input type="hidden" th:id="like_check" th:value="${like}"/>
                <input type="hidden" th:id="investId" th:text="${investDetail.id}"/>
                <img  th:id="likeImg" src="/images/likes-before.png" alt="" width="30px" height="30px">
                <span th:text="${investDetail.likeCnt}"></span>

        </div>

        <div th:if="${#request.getCookies()== null}">
            <!-- 로그인하지 않은 유저라면 -->

                <img th:id="loginCheck" src="/images/likes-before.png" alt="" width="300" height="300">
                <span th:text="${investDetail.likeCnt}"></span>

        </div>

        <!--        <div sec:authorize-expr="isAuthenticated()" or th:unless="${#strings.equals(investDetail.getMember().getMemberId(),login_email)}" class="d-block">-->
        <!-- 로그인 유저와 작성자가 동일하지 않다면 -->
        <!-- 좋아요 -->
        <!--            <input type="hidden" id="like_check" th:value="${like}">-->
        <!--            <img th:id="likeImg" src="/images/likes-before.png" alt="" width="30px"-->
        <!--                 height="30px">-->

        <!--            <span th:text="${investDetail.likecnt}"></span>-->
        <!--        </div>-->
        <!--        <div sec:authorize-expr="!isAuthenticated()">-->
        <!-- 로그인하지 않은 유저라면 -->
        <!--            <img id="loginCheck" src="/images/likes-before.png" alt="" width="30px"-->
        <!--                 height="30px">-->
        <!--            <span th:text="${investDetail.likecnt}"></span>-->
        <!--        </div>-->


    </form>

</div>

<!--<script layout:fragment="script" type='text/javascript'>-->
<script th:inline="javascript">
const btn = document.getElementById("btn");

function test() {
    alert("hi");
}
btn.addEventListener("click", test)
</script>
<script>

    <!--<script>-->

    // const recommend_elements = document.getElementsByClassName("recommend");
    // Array.from(recommend_elements).forEach(function(element) {
    //   element.addEventListener('click', function() {
    //     if(confirm("정말로 좋아요 하시겠습니까?")) {
    //       location.href = this.dataset.uri;
    //     };
    //   });
    // });



    const clickLikeUrl = "/images/likes-after.png";
    const emptyLikeUrl = "/images/likes-before.png";

    // /** 좋아요 유무에 따라 하트 그림 다르게 보여줌 **/
    //브라우저가 웹 문서를 읽기 시작하고 DOM이 생성되면 실행되는 메소드
    $(function() {

        // 현재 로그인한 유저가 해당 게시물을 좋아요 했다면 likeVal = true,
        // 좋아요하지 않았다면 false
        let likeVal = $('#like_check').val(); // 데이터가 있으면 true
        const likeImg = $('#likeImg');

        console.log("likeVal : " + likeVal);

        if (likeVal === 'true') {
            // 데이터가 존재하면 화면에 채워진 하트 보여줌
            $('#likeImg').attr("src", clickLikeUrl);
        } else if (likeVal === 'false') {
            // 데이터가 없으면 화면에 빈 하트 보여줌
            $('#likeImg').attr("src", emptyLikeUrl);
        }
    });

    $("#likeImg").click(function(){
        alert("input id 클릭");
    });

    //좋아요 클릭시 실행
    $('#likeImg').click(function () {
        alert(인풋클릭);
        const investId = $('#investId').val();
        const likeVal = $('#like_check').val();

        console.log(investId);
        if (likeVal === 'true') {
            const con_check = confirm("좋아요 취소하시겠습니까?")
            if (con_check) {
                console.log("좋아요 취소 진입");
                $.ajax({
                    type: 'POST',
                    url: '/invest/list/detail/like/' + investId,
                    contentType: 'application/json; charset=utf-8'
                }).done(function () {

                    $('#likeImg').attr("src", emptyLikeUrl);

                    location.reload();
                }).fail(function (error) {
                    alert(JSON.stringify(error));
                })
            }
        } else if (likeVal === 'false') {
            const con_check = confirm("좋아요 하시겠습니까?");
            if (con_check) {
                console.log("추천 진입");
                $.ajax({
                    type: 'POST',
                    url: '/invest/list/detail/like/' + investId,
                    contentType: 'application/json; charset=utf-8'
                }).done(function () {

                    $('#likeImg').attr("src", clickLikeUrl);

                    location.reload();
                }).fail(function (error) {
                    alert(JSON.stringify(error));
                })
            }
        }
    });


    // /** 로그인하지 않은 유저가 좋아요 누를 때 **/
    $('#loginCheck').click(function () {
        alert("로그인 후 이용할 수 있습니다.");
    });

</script>
</body>
</html>